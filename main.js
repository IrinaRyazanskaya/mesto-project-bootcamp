(()=>{"use strict";var e={formSelector:".popup__form",inputSelector:".popup__field",submitButtonSelector:".popup__save-button",inactiveButtonClass:"popup__save-button_inactive",inputErrorClass:"popup__field_type_error",errorClass:"popup__input-error_active"};function t(e,t,n){var o=t.querySelector(".".concat(n.id,"-error"));n.classList.remove(e.inputErrorClass),o.classList.remove(e.errorClass),o.textContent=""}function n(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(t)?(n.removeAttribute("disabled"),n.classList.remove(e.inactiveButtonClass)):(n.setAttribute("disabled",""),n.classList.add(e.inactiveButtonClass))}var o={baseUrl:"https://nomoreparties.co/v1/wbf-cohort-2",headers:{authorization:"70e3b835-7fa1-49d6-af9d-b217b97e0c8e","Content-Type":"application/json"}},r=document.querySelector(".profile__edit-button"),a=document.querySelector(".profile__add-button"),c=document.querySelector("#edit-popup"),u=document.forms["edit-profile"],i=u.querySelector('.popup__field[name="name"]'),s=u.querySelector('.popup__field[name="description"]'),l=document.querySelector(".profile__name"),d=document.querySelector(".profile__description"),p=document.querySelector("#add-popup"),f=document.forms["add-card"],_=f.querySelector('.popup__field[name="place"]'),v=f.querySelector('.popup__field[name="link"]'),m=document.querySelector("#image-popup"),h=document.querySelector(".popup__image"),b=document.querySelector(".popup__caption"),y=document.querySelector(".profile__avatar"),S=document.querySelector(".profile__edit-avatar"),q=document.querySelector("#change-avatar-popup"),k=document.forms["change-avatar"],L=k.querySelector('.popup__field[name="link"]');function E(e){e.classList.add("popup_opened"),document.addEventListener("keydown",g)}function g(e){"Escape"===e.key&&C(document.querySelector(".popup_opened"))}function C(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",g)}var A,j,x,P,z,U=u.querySelector(".popup__save-button"),w=f.querySelector(".popup__save-button"),D=k.querySelector(".popup__save-button"),T=document.querySelector(".gallery__list"),B=document.querySelector("#card").content.querySelector(".gallery__list-item");function N(e,t,n,r,a,c){var u=B.cloneNode(!0),i=u.querySelector(".gallery__photo"),s=u.querySelector(".gallery__place-name"),l=u.querySelector(".gallery__like-button"),d=u.querySelector(".gallery__delete-button"),p=u.querySelector(".gallery__like-counter");return i.src=t,i.alt=n,s.textContent=n,p.textContent=r.length,r.forEach((function(e){e._id===c&&l.classList.add("gallery__like-button_active")})),a._id!==c&&d.classList.add("gallery__delete-button_inactive"),l.addEventListener("click",(function(){!function(e,t,n){e.classList.contains("gallery__like-button_active")?function(e,t){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(t),{method:"DELETE",headers:{authorization:e.headers.authorization}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(o,n).then((function(n){t.textContent=n.likes.length,e.classList.remove("gallery__like-button_active")})).catch((function(e){console.error(e)})):function(e,t){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(t),{method:"PUT",headers:{authorization:e.headers.authorization}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(o,n).then((function(n){t.textContent=n.likes.length,e.classList.add("gallery__like-button_active")})).catch((function(e){console.error(e)}))}(l,p,e)})),d.addEventListener("click",(function(){!function(e,t){(function(e,t){return fetch("".concat(e.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:{authorization:e.headers.authorization}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))})(o,t).then((function(){e.remove()}))}(u,e)})),i.addEventListener("click",(function(){!function(e,t){E(m),h.src=e,h.alt=t,b.textContent=t}(t,n)})),u}r.addEventListener("click",(function(){var n,o,r;n=e,o=l.textContent,r=d.textContent,i.value=o,s.value=r,t(n,u,i),t(n,u,s),E(c)})),a.addEventListener("click",(function(){E(p)})),S.addEventListener("click",(function(){E(q)})),document.querySelectorAll(".popup").forEach((function(e){e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup_opened")&&C(e),t.target.classList.contains("popup__close-button")&&C(e)}))})),u.addEventListener("submit",(function(e){var t,n,r;e.preventDefault(),U.setAttribute("value","Сохранение..."),U.setAttribute("disabled",""),(t=o,n=i.value,r=s.value,fetch("".concat(t.baseUrl,"/users/me"),{method:"PATCH",headers:t.headers,body:JSON.stringify({name:n,about:r})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){l.textContent=e.name,d.textContent=e.about,C(c),U.classList.add("popup__save-button_inactive"),U.setAttribute("value","Сохранить")})).catch((function(e){U.removeAttribute("disabled"),console.error(e)}))})),f.addEventListener("submit",(function(e){var t,n,r;e.preventDefault(),w.setAttribute("value","Сохранение..."),w.setAttribute("disabled",""),(t=o,n=v.value,r=_.value,fetch("".concat(t.baseUrl,"/cards"),{method:"POST",headers:t.headers,body:JSON.stringify({link:n,name:r})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){var t=N(e._id,e.link,e.name,e.likes,e.owner,e.owner._id);T.prepend(t),f.reset(),C(p),w.setAttribute("value","Сохранить"),w.classList.add("popup__save-button_inactive")})).catch((function(e){w.removeAttribute("disabled"),console.error(e)}))})),k.addEventListener("submit",(function(e){var t,n;e.preventDefault(),D.setAttribute("value","Сохранение..."),D.setAttribute("disabled",""),(t=o,n=L.value,fetch("".concat(t.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:t.headers,body:JSON.stringify({avatar:n})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){y.src=e.avatar,k.reset(),C(q),D.classList.add("popup__save-button_inactive"),D.setAttribute("value","Сохранить")})).catch((function(e){D.removeAttribute("disabled"),console.error(e)}))})),A=e,Array.from(document.querySelectorAll(A.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,o){var r=Array.from(o.querySelectorAll(e.inputSelector)),a=o.querySelector(e.submitButtonSelector);n(e,r,a),r.forEach((function(c){c.addEventListener("input",(function(){!function(e,n,o){o.validity.valid?t(e,n,o):function(e,t,n,o){var r=t.querySelector(".".concat(n.id,"-error"));n.classList.add(e.inputErrorClass),r.textContent=o,r.classList.add(e.errorClass)}(e,n,o,o.validationMessage)}(e,o,c),n(e,r,a)}))}))}(A,e)})),(j=o,x=document.querySelector(".profile__name"),P=document.querySelector(".profile__description"),z=document.querySelector(".profile__avatar"),function(e){return fetch("".concat(e.baseUrl,"/users/me"),{headers:{authorization:e.headers.authorization}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(j).then((function(e){return x.textContent=e.name,P.textContent=e.about,z.setAttribute("src",e.avatar),e})).catch((function(e){console.error(e)}))).then((function(e){return function(e,t){(function(e){return fetch("".concat(e.baseUrl,"/cards"),{headers:{authorization:e.headers.authorization}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))})(e).then((function(e){var n=document.createDocumentFragment();e.forEach((function(e){var o=N(e._id,e.link,e.name,e.likes,e.owner,t._id);n.append(o)})),T.append(n)})).catch((function(e){console.error(e)}))}(o,e)}))})();