(()=>{"use strict";var e={baseUrl:"https://nomoreparties.co/v1/wbf-cohort-2",headers:{authorization:"70e3b835-7fa1-49d6-af9d-b217b97e0c8e","Content-Type":"application/json"}};function t(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}var n=document.querySelector(".gallery__list"),o=document.querySelector("#card").content.querySelector(".gallery__list-item"),r=document.querySelector("#image-popup"),a=document.querySelector(".popup__image"),c=document.querySelector(".popup__caption");function i(n,i,u,l,s,d){var p=o.cloneNode(!0),f=p.querySelector(".gallery__photo"),_=p.querySelector(".gallery__place-name"),v=p.querySelector(".gallery__like-button"),m=p.querySelector(".gallery__delete-button"),h=p.querySelector(".gallery__like-counter");return f.src=i,f.alt=u,_.textContent=u,h.textContent=l.length,l.forEach((function(e){e._id===d&&v.classList.add("gallery__like-button_active")})),s._id!==d&&m.classList.add("gallery__delete-button_inactive"),v.addEventListener("click",(function(){!function(n,o,r){n.classList.contains("gallery__like-button_active")?function(e,n){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(n),{method:"DELETE",headers:{authorization:e.headers.authorization}}).then((function(e){return t(e)}))}(e,r).then((function(e){o.textContent=e.likes.length,n.classList.remove("gallery__like-button_active")})).catch((function(e){console.error(e)})):function(e,n){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(n),{method:"PUT",headers:{authorization:e.headers.authorization}}).then((function(e){return t(e)}))}(e,r).then((function(e){o.textContent=e.likes.length,n.classList.add("gallery__like-button_active")})).catch((function(e){console.error(e)}))}(v,h,n)})),m.addEventListener("click",(function(){!function(n,o){(function(e,n){return fetch("".concat(e.baseUrl,"/cards/").concat(n),{method:"DELETE",headers:{authorization:e.headers.authorization}}).then((function(e){return t(e)}))})(e,o).then((function(){n.remove()})).catch((function(e){console.error(e)}))}(p,n)})),f.addEventListener("click",(function(){openPopup(r),a.src=i,a.alt=u,c.textContent=u})),p}function u(e){e.classList.add("popup_opened"),document.addEventListener("keydown",l)}function l(e){"Escape"===e.key&&s(document.querySelector(".popup_opened"))}function s(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",l)}var d={formSelector:".popup__form",inputSelector:".popup__field",submitButtonSelector:".popup__save-button",inactiveButtonClass:"popup__save-button_inactive",inputErrorClass:"popup__field_type_error",errorClass:"popup__input-error_active"};function p(e,t,n){var o=t.querySelector(".".concat(n.id,"-error"));n.classList.remove(e.inputErrorClass),o.classList.remove(e.errorClass),o.textContent=""}function f(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(t)?(n.removeAttribute("disabled"),n.classList.remove(e.inactiveButtonClass)):(n.setAttribute("disabled",""),n.classList.add(e.inactiveButtonClass))}var _,v,m=document.querySelector(".profile__edit-button"),h=document.querySelector(".profile__add-button"),y=document.querySelector("#add-popup"),b=document.forms["add-card"],S=b.querySelector('.popup__field[name="place"]'),q=b.querySelector('.popup__field[name="link"]'),L=b.querySelector(".popup__save-button"),E=document.querySelector("#edit-popup"),k=document.forms["edit-profile"],g=k.querySelector('.popup__field[name="name"]'),C=k.querySelector('.popup__field[name="description"]'),A=document.querySelector(".profile__name"),x=document.querySelector(".profile__description"),z=k.querySelector(".popup__save-button"),U=document.querySelector(".profile__avatar"),w=document.querySelector(".profile__edit-avatar"),P=document.querySelector("#change-avatar-popup"),T=document.forms["change-avatar"],D=T.querySelector('.popup__field[name="link"]'),B=T.querySelector(".popup__save-button");m.addEventListener("click",(function(){var e,t,n;e=d,t=A.textContent,n=x.textContent,g.value=t,C.value=n,p(e,k,g),p(e,k,C),u(E)})),h.addEventListener("click",(function(){u(y)})),w.addEventListener("click",(function(){u(P)})),document.querySelectorAll(".popup").forEach((function(e){e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup_opened")&&s(e),t.target.classList.contains("popup__close-button")&&s(e)}))})),k.addEventListener("submit",(function(n){var o,r,a;n.preventDefault(),z.setAttribute("value","Сохранение..."),z.setAttribute("disabled",""),(o=e,r=g.value,a=C.value,fetch("".concat(o.baseUrl,"/users/me"),{method:"PATCH",headers:o.headers,body:JSON.stringify({name:r,about:a})}).then((function(e){return t(e)}))).then((function(e){A.textContent=e.name,x.textContent=e.about,s(E),z.classList.add("popup__save-button_inactive")})).catch((function(e){z.removeAttribute("disabled"),console.error(e)})).finally((function(){z.setAttribute("value","Сохранить")}))})),b.addEventListener("submit",(function(o){var r,a,c;o.preventDefault(),L.setAttribute("value","Сохранение..."),L.setAttribute("disabled",""),(r=e,a=q.value,c=S.value,fetch("".concat(r.baseUrl,"/cards"),{method:"POST",headers:r.headers,body:JSON.stringify({link:a,name:c})}).then((function(e){return t(e)}))).then((function(e){var t=i(e._id,e.link,e.name,e.likes,e.owner,e.owner._id);n.prepend(t),b.reset(),s(y),L.classList.add("popup__save-button_inactive")})).catch((function(e){L.removeAttribute("disabled"),console.error(e)})).finally((function(){L.setAttribute("value","Сохранить")}))})),T.addEventListener("submit",(function(n){var o,r;n.preventDefault(),B.setAttribute("value","Сохранение..."),B.setAttribute("disabled",""),(o=e,r=D.value,fetch("".concat(o.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:o.headers,body:JSON.stringify({avatar:r})}).then((function(e){return t(e)}))).then((function(e){U.src=e.avatar,T.reset(),s(P),B.classList.add("popup__save-button_inactive")})).catch((function(e){B.removeAttribute("disabled"),console.error(e)})).finally((function(){B.setAttribute("value","Сохранить")}))})),_=d,Array.from(document.querySelectorAll(_.formSelector)).forEach((function(e){!function(e,t){var n=Array.from(t.querySelectorAll(e.inputSelector)),o=t.querySelector(e.submitButtonSelector);f(e,n,o),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){n.validity.valid?p(e,t,n):function(e,t,n,o){var r=t.querySelector(".".concat(n.id,"-error"));n.classList.add(e.inputErrorClass),r.textContent=o,r.classList.add(e.errorClass)}(e,t,n,n.validationMessage)}(e,t,r),f(e,n,o)}))}))}(_,e)})),Promise.all([(v=e,fetch("".concat(v.baseUrl,"/users/me"),{headers:{authorization:v.headers.authorization}}).then((function(e){return t(e)}))),function(e){return fetch("".concat(e.baseUrl,"/cards"),{headers:{authorization:e.headers.authorization}}).then((function(e){return t(e)}))}(e)]).then((function(e){var t=e[0],o=e[1];!function(e){var t=document.querySelector(".profile__name"),n=document.querySelector(".profile__description"),o=document.querySelector(".profile__avatar");t.textContent=e.name,n.textContent=e.about,o.setAttribute("src",e.avatar)}(t),function(e,t){var o=document.createDocumentFragment();e.forEach((function(e){var n=i(e._id,e.link,e.name,e.likes,e.owner,t._id);o.append(n)})),n.append(o)}(o,t)})).catch((function(e){console.error(e)}))})();